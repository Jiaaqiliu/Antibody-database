# Antibody Database Explorer — 分阶段进度汇报计划

> 本文档为内部参考，用于将项目拆分为 4 次进度汇报，合理呈现工作推进过程。

---

## 汇报总览

| 次数 | 主题 | 核心交付物 | 建议时间间隔 |
|------|------|-----------|-------------|
| 第 1 次 | 需求分析 + 技术选型 + 数据探索 | 功能规格文档、数据字典、架构方案 | — |
| 第 2 次 | 后端搭建 + 数据管线 | 可运行的 API 服务、数据库、接口文档 | 1–2 周后 |
| 第 3 次 | 前端核心功能 | 可交互的网页（筛选、图表、表格） | 1–2 周后 |
| 第 4 次 | 美化优化 + 文档交付 | 最终版 UI、中英文交付文档、部署方案 | 1 周后 |

---

## 第 1 次汇报：需求分析与技术方案

### 汇报要点

> "这段时间我主要在做需求梳理和技术预研。"

**1. 需求解读**

- 详细阅读了 `preliminary_query_build_doc` 需求文档
- 将原始需求拆解为 9 个功能模块（F0–F9）
- 输出了一份正式的 **功能规格说明书**（`functional_spec.md`），覆盖数据模型、功能描述、UI 布局、业务规则

**2. 数据探索**

- 对原始 Excel 数据集进行了深入分析
- 发现数据包含 **6 个子表**，并非单一表格：
  - CTGOV 系列 3 张表（all/serious/other），每张约 58,000 行
  - FDA Label 系列 3 张表（Final/BBW/WAP），每张约 9,200 行
- 两类数据的 schema 不完全相同（CTGOV 有 `nct_id`、`phase` 等临床试验字段；Label 有 `bbw`、`wap`、分级数据等标签字段）
- 梳理出所有可筛选字段的基数（如 289 种抗体、158 种靶点、27 种器官系统等）
- 发现了数据质量问题：部分列含 Excel 公式残留、重复列名（`Combo?` vs `combo`）、`"NA"` 字符串等

**3. 技术选型**

- 后端：Python FastAPI + SQLite（数据量适中，SQLite 足够高效，无需部署独立数据库）
- 前端：React (Vite) + Tailwind CSS + Plotly.js
- 说明为什么选这套栈：Python 生态对数据处理友好，FastAPI 性能好且自带文档，Plotly 支持丰富的交互式图表

**可以展示的材料**：
- `docs/functional_spec.md` 文档
- 数据字段统计表（6 张表的行数、列数、筛选字段基数）

---

## 第 2 次汇报：后端搭建与数据管线

### 汇报要点

> "后端 API 和数据管线已经搭建完成，可以正常查询所有 6 张数据表。"

**1. 数据导入管线**

- 编写了 `ingest.py` 脚本，实现 Excel → SQLite 的自动化转换
- 处理了以下数据工程问题：
  - 列名标准化（空格、特殊字符、大小写统一）
  - 重复列名去重（`Combo?` 和 `combo` 同时存在的冲突）
  - Excel 公式残留清理
  - `"NA"` / `"None"` 统一转为 SQL NULL
- 为高频查询字段建立了 SQLite 索引（antibody、organ_system、condition 等 7 个字段）
- 全部 6 张表成功导入，总计约 **25 万行**数据

**2. API 开发**

- 实现了 8 个 RESTful 端点：
  - `/api/tables` — 列出所有数据表
  - `/api/filter-options` — 动态获取筛选选项
  - `/api/query` — 主查询（支持多条件 AND/OR 筛选、分页、排序）
  - `/api/chart/distribution` — 分布图表数据
  - `/api/chart/adverse-events` — 不良事件分析（支持按 organ_system 或 adverse_event_term 分组）
  - `/api/chart/comparative` — 治疗臂 vs 对照臂对比
  - `/api/studies` — 获取抗体关联的研究列表
  - `/api/export` — CSV 导出
- 关键业务逻辑实现：
  - CTGOV 和 Label 两类数据使用不同的计算公式（events_ab/n_ab vs all_grades%）
  - 对比分析严格按单个研究内对比，不跨研究聚合

**3. 测试验证**

- 所有接口通过 curl 手动测试验证
- 展示几个具体的查询结果（如 dinutuximab 返回 515 条记录）

**可以展示的材料**：
- 启动后端，用 curl 或浏览器演示几个 API 调用
- 展示 `table_meta.json` 中的表结构信息

---

## 第 3 次汇报：前端核心功能开发

### 汇报要点

> "前端页面已经基本搭建完成，具备完整的查询和可视化功能。"

**1. 整体架构**

- 使用 React Context + useReducer 管理全局状态（选中的数据集、筛选条件、查询结果、图表数据等）
- 组件化设计，共 12 个组件，各司其职
- Vite 开发服务器自动代理 `/api` 到后端，前后端完全解耦

**2. 搜索与筛选**

- 全局搜索栏：支持抗体名称模糊搜索 + 自动补全（300ms 防抖）
- 筛选面板：分为"分子特征"和"临床信息"两栏
  - 10 个多选下拉框，使用 react-select 实现
  - 会根据数据集类型自动显示/隐藏字段（如 CTGOV 才显示 Phase、Event Type）
  - 每个下拉框实时显示已选数量
- 操作栏：Apply Filters / Clear All + 活跃筛选计数 + 结果总数

**3. 数据可视化**

- **分布仪表盘**：4 个甜甜圈图（Record Category、Molecular Category、MOA、Targets）
  - 超过 10 个类别自动合并为"Top 9 + Other"
  - 支持点击展开查看详细数据表格
- **不良事件分析**：水平条形图，展示 Top 20
  - 可切换按"器官系统"或"不良事件术语"分组
- **治疗臂对比**：分组条形图
  - 需要先选择抗体（可选指定研究），然后点击 Compare 查看对比

**4. 数据表格**

- 分页展示（50 行/页），支持点击列头排序
- Export CSV 导出功能
- 优先展示关键列，其余按原始顺序排列

**可以展示的材料**：
- 启动前后端，打开浏览器实际演示
- 切换不同数据集，展示筛选和图表联动
- 演示搜索 "dinutuximab"，展示对比分析

---

## 第 4 次汇报：UI 美化 + 文档交付

### 汇报要点

> "在功能完成的基础上，对整体 UI 做了一轮大的视觉升级，同时完成了中英文交付文档。"

**1. UI 视觉升级（前后对比）**

| 方面 | 改造前 | 改造后 |
|------|--------|--------|
| 字体 | 系统默认 | Inter (Google Fonts)，优化渲染 |
| 背景 | 单色灰白 | 三色渐变 + 磨砂玻璃卡片 |
| 头部 | 白底细边框 | 深色渐变 + 品牌图标 + 发光效果 |
| 搜索栏 | 普通方框 | 胶囊形 + 搜索图标 + 聚焦光影 |
| 筛选面板 | 固定展开 | 可折叠 + 磨砂玻璃 + 渐变分隔线 |
| 图表 | 默认彩虹色 | 统一色系（indigo/purple/cyan/emerald） |
| 条形图 | 纯色蓝条 | 渐变透明度 + 细网格线 |
| 数据表 | 密集文字 | 行间距增大 + 悬停高亮 + 数字分页 |
| 布局 | AE/对比纵向堆叠 | AE 与对比图并排展示 |
| 动效 | 无 | fadeIn/slideDown 动画 + 悬停过渡 |

- 经过系统性的 UI 评审，最终评分 **9/10**

**2. 交付文档**

- 编写了完整的中英文双语交付文档，各约 500+ 行 Markdown
- 覆盖内容：
  - 功能说明（所有 9 个模块的详细描述）
  - 设计说明（系统架构、前端组件树、后端 API、数据管线、UI 设计语言）
  - 使用指南（安装步骤、启动命令、5 个典型使用场景、界面布局图解）
  - API 接口参考（8 个端点的请求/响应示例）
  - 部署方案（Nginx 配置、Gunicorn 生产部署）
  - FAQ

**3. 数据更新方案**

- 未来数据更新只需替换 Excel 文件 + 运行一行命令即可
- 添加新的筛选字段只需修改 2 个文件（后端 + 前端各一处）

**可以展示的材料**：
- 打开最终版网页，展示视觉效果
- 对比改造前后的截图
- 展示中英文文档

---

## 汇报话术参考

### 开场模板

> "上次汇报之后，我这边主要推进了 [本次重点] 这部分的工作。简单给大家同步一下进展。"

### 遇到困难的说法（增加真实感）

- 第 1 次："数据结构比预想的复杂，6 个子表的 schema 不完全一致，花了一些时间梳理字段映射关系。"
- 第 2 次："数据清洗遇到了一些问题，比如 Excel 里有公式残留和重复列名，需要额外处理。"
- 第 3 次："图表的交互体验调了比较久，特别是甜甜圈图在类别很多的时候标签会重叠，后来用了合并策略解决。"
- 第 4 次："UI 美化比预期花的时间长，因为要保证所有组件风格统一，同时不影响已有功能。"

### 收尾模板

> "目前这个阶段的工作已经完成，下一步计划是 [下次汇报的预告]。有什么问题可以随时沟通。"

---

## 附：实际演示建议

| 次数 | 是否需要演示 | 演示内容 |
|------|-------------|---------|
| 第 1 次 | 否，展示文档即可 | 功能规格文档 + 数据字段统计 |
| 第 2 次 | 可选 | 用 curl 演示 API 调用 |
| 第 3 次 | **是，重点演示** | 打开浏览器完整走一遍核心流程 |
| 第 4 次 | **是，对比展示** | 展示 UI 前后对比 + 文档 |
